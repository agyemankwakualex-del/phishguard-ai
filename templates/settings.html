{% extends "base.html" %}

{% block title %}Settings - PhishGuard AI{% endblock %}
{% block page_title %}Settings{% endblock %}

{% block content %}
<div class="settings-container">
    
    <!-- System Status (Replaces API Key Form) -->
    <div class="card">
        <div class="card-header">
            <h3>ü§ñ System Status</h3>
        </div>
        <div class="card-body">
            <div class="gmail-status connected" style="background: rgba(30, 41, 59, 0.5);">
                <div class="status-info">
                    <span class="status-icon">‚ú®</span>
                    <div>
                        <strong>PhishGuard Pro</strong>
                        <p>Managed API Access Active</p>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 10px;">
                    <span class="badge" style="background: {{ 'var(--success)' if config.groq_active else 'var(--danger)' }}; padding: 5px 10px; border-radius: 4px; color: white;">
                        {{ '‚úì AI Engine Online' if config.groq_active else '‚ö† AI Config Missing' }}
                    </span>
                    <span class="badge" style="background: {{ 'var(--success)' if config.vt_active else 'var(--danger)' }}; padding: 5px 10px; border-radius: 4px; color: white;">
                        {{ '‚úì Virus Scanner Online' if config.vt_active else '‚ö† Scanner Config Missing' }}
                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Gmail Connection -->
    <div class="card">
        <div class="card-header">
            <h3>üìß Gmail Connection</h3>
        </div>
        <div class="card-body">
            {% if config.gmail_connected %}
            <div class="gmail-status connected">
                <div class="status-info">
                    <span class="status-icon">‚úÖ</span>
                    <div>
                        <strong>Connected</strong>
                        <p>{{ config.gmail_email }}</p>
                    </div>
                </div>
                <div class="gmail-actions">
                    <a href="{{ url_for('gmail_scan') }}" class="action-button primary">
                        üîç Scan Inbox
                    </a>
                    <a href="{{ url_for('gmail_disconnect') }}" class="action-button danger">
                        ‚ùå Disconnect
                    </a>
                </div>
            </div>
            {% elif config.gmail_available %}
            <div class="gmail-status disconnected">
    <p>Connect your Gmail to automatically scan your inbox for phishing emails.</p>
    
    <!-- ADD THIS NOTE -->
    <p style="font-size: 0.8rem; color: var(--warning); margin-bottom: 15px; background: rgba(245, 158, 11, 0.1); padding: 10px; border-radius: 4px;">
        ‚ö†Ô∏è <strong>Note:</strong> Due to Google Security restrictions, Gmail integration is currently invite-only. 
        <br>Please contact the admin to whitelist your email address.
    </p>
    
    <a href="{{ url_for('gmail_connect') }}" class="action-button primary">
        üîó Connect Gmail
    </a>
</div>
            {% else %}
            <div class="gmail-status unavailable">
                <p>‚ö†Ô∏è Gmail integration is not configured on this server.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.gmail-status { padding: 20px; border-radius: 8px; }
.gmail-status.connected { background: rgba(39, 174, 96, 0.1); }
.gmail-status.disconnected { text-align: center; padding: 30px; }
.gmail-status.unavailable { background: rgba(243, 156, 18, 0.1); padding: 20px; text-align: center; }
.status-info { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
.status-icon { font-size: 28px; }
.status-info p { color: #888; margin: 4px 0 0 0; font-size: 14px; }
.gmail-actions { display: flex; gap: 12px; }
.action-button.danger { background: #e74c3c; }
</style>
{% endblock %}